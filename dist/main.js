(()=>{var __webpack_modules__={101:(a,t,e)=>{const i=e(927),s=e(822),n=["updateScene","updateDrawing","deleteDrawing"];a.exports=class{static initialize(){i.Hooks.on("canvasReady",this.handleCanvasReady.bind(this)),n.forEach((a=>{i.Hooks.on(a,this.updateActiveDrawingTargets.bind(this))}))}static handleCanvasReady(){i.canvas().stage.on("click",this.handleBoardClick.bind(this)),this.updateActiveDrawingTargets()}static updateActiveDrawingTargets(){this.activeDrawingTargets=i.canvas().drawings.placeables.filter((a=>this.drawingHasClickMacro(a)&&this.macroEnabledForHiddenStatus(a)))}static drawingHasClickMacro(a){const t=a.data.flags.hotspots;return t&&t.click&&t.click.macro&&t.click.macro.length}static macroEnabledForHiddenStatus(a){return!(a.data.flags.hotspots.click.disableHidden&&a.data.hidden)}static handleBoardClick(a){if(!this.activeDrawingTargets.length||i.canvas().activeLayer===i.canvas().drawings)return;const t=this.getCanvasPoint(a),e=this.activeDrawingTargets.find((a=>this.isPointInsideBoundingBox(t,a)&&this.isPointInsideShape(t,a)));e&&this.executeClickMacro(e)}static getCanvasPoint(a){const t=i.canvas(),{tx:e,ty:s}=t.tokens.worldTransform,{x:n,y:r}=t.stage.scale;return{x:(a.data.global.x-e)/n,y:(a.data.global.y-s)/r}}static isPointInsideBoundingBox(a,t){const{width:e,height:i,x:s,y:n}=t.data;return Number.between(a.x,s,s+e)&&Number.between(a.y,n,n+i)}static isPointInsideShape(a,t){const{data:e}=t,{width:s,height:n,x:r,y:o}=e;if(e.type===i.CONST.DRAWING_TYPES.RECTANGLE)return!0;if(e.type===i.CONST.DRAWING_TYPES.ELLIPSE){if(!s||!n)return!1;const t=r+s/2-a.x,e=o+n/2-a.y;return t*t*4/(s*s)+e*e*4/(n*n)<=1}if(e.type===i.CONST.DRAWING_TYPES.POLYGON){const t=a.x-r,i=a.y-o;let s=0;for(let a=0;a<e.points.length;++a){let n=a+1===e.points.length?0:a+1;e.points[a][1]<=i&&e.points[n][1]>i&&(e.points[n][0]-e.points[a][0])*(i-e.points[a][1])-(e.points[n][1]-e.points[a][1])*(t-e.points[a][0])>0&&++s,e.points[a][1]>i&&e.points[n][1]<=i&&(e.points[n][0]-e.points[a][0])*(i-e.points[a][1])-(e.points[n][1]-e.points[a][1])*(t-e.points[a][0])<0&&--s}return 0!==s}}static async executeClickMacro(a){const{macro:t,pack:e}=a.data.flags.hotspots.click;s.execute(await s.find(t,e))}}},344:(a,t,e)=>{const i=e(927),s=e(822),n=[i.CONST.DRAWING_TYPES.RECTANGLE,i.CONST.DRAWING_TYPES.ELLIPSE,i.CONST.DRAWING_TYPES.POLYGON];class r{static initialize(){i.Hooks.on("renderDrawingConfig",r.handleRenderDrawingConfig.bind(this))}static async handleRenderDrawingConfig(a,t,e){if(!i.game().user.isGM||!n.includes(e.object.type))return;const s=await this.prepareData(e);await this.injectTab(t,s),this.createDropZones(t),this.addDeleteListeners(t)}static async prepareData(a){const t=a.object.flags.hotspots||{};return await Promise.all(Object.values(t).filter((({macro:a})=>a&&a.length)).map((async a=>{const t=await s.find(a.macro,a.pack);a.img=t.data.img}))),t}static async injectTab(a,t){i.renderTemplate("modules/hotspots/templates/drawing-config-hotspots-nav.hbs").then((t=>{a.find(".tabs .item").last().after(t)}));const e=await i.renderTemplate("modules/hotspots/templates/drawing-config-hotspots-tab.hbs",t);await a.find(".tab").last().after(e)}static createDropZones(a){new i.DragDrop({dropSelector:".hotspots-macro-target",callbacks:{drop:this.handleDrop.bind(this)}}).bind(a[0])}static async handleDrop(a){const t=JSON.parse(a.dataTransfer.getData("text/plain"));if("Macro"!==t.type)return;const{id:e,pack:i}=t,n=await s.find(e,i),r="IMG"===a.target.tagName?a.target:a.target.firstChild;r.src=n.data.img,r.previousElementSibling.classList.add("enabled");const o=$(r).closest(".form-group");o.find("input[data-field='macro']").val(e),o.find("input[data-field='pack']").val(i)}static addDeleteListeners(a){a.find(".hotspots-delete-macro").on("click",(({target:a})=>{a.classList.remove("enabled");const t=$(a).closest(".form-group");t.find("input[data-field='macro']").val(""),t.find("input[data-field='pack']").val(""),t.find("img").attr("src","data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=")}))}}a.exports=r},822:(module,__unused_webpack_exports,__webpack_require__)=>{const Foundry=__webpack_require__(927);class MacroManager{static async find(a,t){return t?await game.packs.get(t).getEntity(a):game.macros.get(a)}static execute(macro){if("chat"===macro.data.type)ui.chat.processMessage(macro.data.command).catch((a=>{ui.notifications.error("There was an error in your chat message syntax."),console.error(a)}));else if("script"===macro.data.type)try{eval(macro.data.command)}catch(a){ui.notifications.error("There was an error in your macro syntax. See the browser console for details"),console.error(a)}}}module.exports=MacroManager},927:a=>{a.exports={renderTemplate,DragDrop,Hooks,CONST,game:()=>game,canvas:()=>canvas}}},__webpack_module_cache__={};function __webpack_require__(a){var t=__webpack_module_cache__[a];if(void 0!==t)return t.exports;var e=__webpack_module_cache__[a]={exports:{}};return __webpack_modules__[a](e,e.exports,__webpack_require__),e.exports}var __webpack_exports__={};(()=>{const a=__webpack_require__(927),t=__webpack_require__(344),e=__webpack_require__(101);a.Hooks.on("init",(()=>{t.initialize(),e.initialize()}))})()})();