(()=>{var __webpack_modules__={101:(t,a,e)=>{const s=e(927),i=e(293),n=["updateScene","updateDrawing","deleteDrawing"];t.exports=class{static initialize(){s.Hooks.on("canvasReady",this.handleCanvasReady.bind(this)),n.forEach((t=>{s.Hooks.on(t,this.updateActiveDrawingTargets.bind(this))}))}static handleCanvasReady(){s.canvas().stage.on("click",this.handleBoardClick.bind(this)),this.updateActiveDrawingTargets()}static updateActiveDrawingTargets(){this.activeDrawingTargets=s.canvas().drawings.placeables.filter((t=>this.drawingHasClickHotspot(t)&&this.hotspotEnabledForHiddenStatus(t)))}static drawingHasClickHotspot(t){const{hotspots:a}=t.data.flags;return a&&a.click&&a.click.uuid&&a.click.uuid.length}static hotspotEnabledForHiddenStatus(t){return!(t.data.flags.hotspots.click.disableHidden&&t.data.hidden)}static handleBoardClick(t){if(!this.activeDrawingTargets.length||s.canvas().activeLayer===s.canvas().drawings)return;const a=this.getCanvasPoint(t),e=this.activeDrawingTargets.find((t=>this.isPointInsideBoundingBox(a,t)&&this.isPointInsideShape(a,t)));e&&this.triggerEntity(e)}static getCanvasPoint(t){const a=s.canvas(),{tx:e,ty:i}=a.tokens.worldTransform,{x:n,y:r}=a.stage.scale;return{x:(t.data.global.x-e)/n,y:(t.data.global.y-i)/r}}static isPointInsideBoundingBox(t,a){const{width:e,height:s,x:i,y:n}=a.data;return Number.between(t.x,i,i+e)&&Number.between(t.y,n,n+s)}static isPointInsideShape(t,a){const{data:e}=a,{width:i,height:n,x:r,y:o}=e;if(e.type===s.CONST.DRAWING_TYPES.RECTANGLE)return!0;if(e.type===s.CONST.DRAWING_TYPES.ELLIPSE){if(!i||!n)return!1;const a=r+i/2-t.x,e=o+n/2-t.y;return a*a*4/(i*i)+e*e*4/(n*n)<=1}if(e.type===s.CONST.DRAWING_TYPES.POLYGON){const a=t.x-r,s=t.y-o;let i=0;for(let t=0;t<e.points.length;++t){const n=t+1===e.points.length?0:t+1;e.points[t][1]<=s&&e.points[n][1]>s&&(e.points[n][0]-e.points[t][0])*(s-e.points[t][1])-(e.points[n][1]-e.points[t][1])*(a-e.points[t][0])>0&&++i,e.points[t][1]>s&&e.points[n][1]<=s&&(e.points[n][0]-e.points[t][0])*(s-e.points[t][1])-(e.points[n][1]-e.points[t][1])*(a-e.points[t][0])<0&&--i}return 0!==i}return!1}static async triggerEntity(t){(await i.fromUuid(t.data.flags.hotspots.click.uuid)).activate()}}},344:(t,a,e)=>{const s=e(927),i=e(293),n=[s.CONST.DRAWING_TYPES.RECTANGLE,s.CONST.DRAWING_TYPES.ELLIPSE,s.CONST.DRAWING_TYPES.POLYGON],r=["Actor","Item","Scene","JournalEntry","Macro","RollTable","Playlist"];class o{static initialize(){s.Hooks.on("renderDrawingConfig",o.handleRenderDrawingConfig.bind(this))}static async handleRenderDrawingConfig(t,a,e){if(!s.game().user.isGM||!n.includes(e.object.type))return;const i=await this.prepareData(e);await this.injectTab(a,i),this.createDropZones(a),this.addDeleteListeners(a)}static async prepareData(t){const a=t.object.flags.hotspots||{};return await Promise.all(Object.values(a).filter((({uuid:t})=>t&&t.length)).map((async t=>{t.img=await(await i.fromUuid(t.uuid)).getImg()}))),a}static async injectTab(t,a){s.renderTemplate("modules/hotspots/templates/drawing-config-hotspots-nav.hbs").then((a=>{t.find(".tabs .item").last().after(a)}));const e=await s.renderTemplate("modules/hotspots/templates/drawing-config-hotspots-tab.hbs",a);await t.find(".tab").last().after(e)}static createDropZones(t){new s.DragDrop({dropSelector:".hotspots-macro-target",callbacks:{drop:this.handleDrop.bind(this)}}).bind(t[0])}static async handleDrop(t){const{type:a,pack:e,id:s}=JSON.parse(t.dataTransfer.getData("text/plain"));if(!r.includes(a))return;const n=e?`Compendium.${e}.${s}`:`${a}.${s}`,o=await i.fromUuid(n),c="IMG"===t.target.tagName?t.target:t.target.firstChild;c.src=await o.getImg(),c.previousElementSibling.classList.add("enabled"),$(c).closest(".form-group").find("input[type='hidden']").val(n)}static addDeleteListeners(t){t.find(".hotspots-delete-macro").on("click",(({target:t})=>{t.classList.remove("enabled");const a=$(t).closest(".form-group");a.find("input[type='hidden']").val(""),a.find("img").attr("src","data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=")}))}}t.exports=o},293:(t,a,e)=>{const s=e(927);class i{static async fromUuid(t){console.log("Creating one for ",t);const a=await s.fromUuid(t);return new(i.subclasses[a.entity]||i)(t,a)}constructor(t,a){this.uuid=t,this.object=a}async getImg(){return"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="}async activate(){console.log("Not yet defined")}}t.exports=i,i.subclasses={Macro:e(47),JournalEntry:e(254)}},254:(t,a,e)=>{const s=e(293),i=e(927);t.exports=class extends s{async activate(){i.Journal._showEntry(this.uuid)}}},47:(module,__unused_webpack_exports,__webpack_require__)=>{const Entity=__webpack_require__(293),Foundry=__webpack_require__(927);class Macro extends Entity{async getImg(){return this.object.data.img}async activate(){const macro=this.object;if("chat"===macro.data.type)Foundry.ui.chat.processMessage(macro.data.command).catch((t=>{Foundry.ui.notifications.error("There was an error in your chat message syntax."),console.error(t)}));else if("script"===macro.data.type)try{eval(macro.data.command)}catch(t){Foundry.ui.notifications.error("There was an error in your macro syntax. See the browser console for details"),console.error(t)}}}module.exports=Macro},927:t=>{t.exports={renderTemplate,DragDrop,Hooks,CONST,fromUuid,Journal,ui,game:()=>game,canvas:()=>canvas}}},__webpack_module_cache__={};function __webpack_require__(t){var a=__webpack_module_cache__[t];if(void 0!==a)return a.exports;var e=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](e,e.exports,__webpack_require__),e.exports}var __webpack_exports__={};(()=>{const t=__webpack_require__(927),a=__webpack_require__(344),e=__webpack_require__(101);t.Hooks.on("init",(()=>{a.initialize(),e.initialize()}))})()})();