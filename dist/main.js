(()=>{var __webpack_modules__={101:(t,a,e)=>{const i=e(927),s=e(293),n=["updateScene","updateDrawing","deleteDrawing"];t.exports=class{static initialize(){i.Hooks.on("canvasReady",this.handleCanvasReady.bind(this)),n.forEach((t=>{i.Hooks.on(t,this.updateActiveDrawingTargets.bind(this))}))}static handleCanvasReady(){i.canvas().stage.on("click",this.handleBoardClick.bind(this)),this.updateActiveDrawingTargets()}static updateActiveDrawingTargets(){this.activeDrawingTargets=i.canvas().drawings.placeables.filter((t=>this.drawingHasClickHotspot(t)&&this.hotspotEnabledForHiddenStatus(t)))}static drawingHasClickHotspot(t){const{hotspots:a}=t.data.flags;return a&&a.click&&a.click.uuid&&a.click.uuid.length}static hotspotEnabledForHiddenStatus(t){return!(t.data.flags.hotspots.click.disableHidden&&t.data.hidden)}static handleBoardClick(t){if(!this.activeDrawingTargets.length||i.canvas().activeLayer===i.canvas().drawings)return;const a=this.getCanvasPoint(t),e=this.activeDrawingTargets.find((t=>this.isPointInsideBoundingBox(a,t)&&this.isPointInsideShape(a,t)));e&&this.triggerEntity(e)}static getCanvasPoint(t){const a=i.canvas(),{tx:e,ty:s}=a.tokens.worldTransform,{x:n,y:r}=a.stage.scale;return{x:(t.data.global.x-e)/n,y:(t.data.global.y-s)/r}}static isPointInsideBoundingBox(t,a){const{width:e,height:i,x:s,y:n}=a.data;return Number.between(t.x,s,s+e)&&Number.between(t.y,n,n+i)}static isPointInsideShape(t,a){const{data:e}=a,{width:s,height:n,x:r,y:o}=e;if(e.type===i.CONST.DRAWING_TYPES.RECTANGLE)return!0;if(e.type===i.CONST.DRAWING_TYPES.ELLIPSE){if(!s||!n)return!1;const a=r+s/2-t.x,e=o+n/2-t.y;return a*a*4/(s*s)+e*e*4/(n*n)<=1}if(e.type===i.CONST.DRAWING_TYPES.POLYGON){const a=t.x-r,i=t.y-o;let s=0;for(let t=0;t<e.points.length;++t){const n=t+1===e.points.length?0:t+1;e.points[t][1]<=i&&e.points[n][1]>i&&(e.points[n][0]-e.points[t][0])*(i-e.points[t][1])-(e.points[n][1]-e.points[t][1])*(a-e.points[t][0])>0&&++s,e.points[t][1]>i&&e.points[n][1]<=i&&(e.points[n][0]-e.points[t][0])*(i-e.points[t][1])-(e.points[n][1]-e.points[t][1])*(a-e.points[t][0])<0&&--s}return 0!==s}return!1}static async triggerEntity(t){s.fromUuid(t.data.flags.hotspots.click.uuid).activate()}}},344:(t,a,e)=>{const i=e(927),s=e(293),n=[i.CONST.DRAWING_TYPES.RECTANGLE,i.CONST.DRAWING_TYPES.ELLIPSE,i.CONST.DRAWING_TYPES.POLYGON],r=["Actor","Item","Scene","JournalEntry","Macro","RollTable","Playlist"];class o{static initialize(){i.Hooks.on("renderDrawingConfig",o.handleRenderDrawingConfig.bind(this))}static async handleRenderDrawingConfig(t,a,e){if(!i.game().user.isGM||!n.includes(e.object.type))return;const s=await this.prepareData(e);await this.injectTab(a,s),this.createDropZones(a),this.addDeleteListeners(a)}static async prepareData(t){const a=t.object.flags.hotspots||{};return await Promise.all(Object.values(a).filter((({uuid:t})=>t&&t.length)).map((async t=>{t.img=await s.fromUuid(t.uuid).getImg()}))),a}static async injectTab(t,a){i.renderTemplate("modules/hotspots/templates/drawing-config-hotspots-nav.hbs").then((a=>{t.find(".tabs .item").last().after(a)}));const e=await i.renderTemplate("modules/hotspots/templates/drawing-config-hotspots-tab.hbs",a);await t.find(".tab").last().after(e)}static createDropZones(t){new i.DragDrop({dropSelector:".hotspots-macro-target",callbacks:{drop:this.handleDrop.bind(this)}}).bind(t[0])}static async handleDrop(t){const{type:a,pack:e,id:i}=JSON.parse(t.dataTransfer.getData("text/plain"));if(!r.includes(a))return;const n=e?`Compendium.${e}.${i}`:`${a}.${i}`,o=s.fromUuid(n),c="IMG"===t.target.tagName?t.target:t.target.firstChild;c.src=await o.getImg(),c.previousElementSibling.classList.add("enabled"),$(c).closest(".form-group").find("input[type='hidden']").val(n)}static addDeleteListeners(t){t.find(".hotspots-delete-macro").on("click",(({target:t})=>{t.classList.remove("enabled");const a=$(t).closest(".form-group");a.find("input[type='hidden']").val(""),a.find("img").attr("src","data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=")}))}}t.exports=o},293:(t,a,e)=>{const i=e(927),s=e(822);class n{static fromUuid(t){return new n(t)}constructor(t){this.uuid=t,this.entity=i.fromUuid(t)}async getImg(){const t=await this.entity;return"Macro"===t.entity?t.data.img:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="}async activate(){const t=await this.entity;"Macro"===t.entity?s.execute(t):"JournalEntry"===t.entity&&i.Journal._showEntry(this.uuid)}}t.exports=n},822:(module,__unused_webpack_exports,__webpack_require__)=>{const Foundry=__webpack_require__(927);class MacroManager{static async find(t,a){return a?Foundry.game().packs.get(a).getEntity(t):Foundry.game().macros.get(t)}static execute(macro){if("chat"===macro.data.type)Foundry.ui.chat.processMessage(macro.data.command).catch((t=>{Foundry.ui.notifications.error("There was an error in your chat message syntax."),console.error(t)}));else if("script"===macro.data.type)try{eval(macro.data.command)}catch(t){Foundry.ui.notifications.error("There was an error in your macro syntax. See the browser console for details"),console.error(t)}}}module.exports=MacroManager},927:t=>{t.exports={renderTemplate,DragDrop,Hooks,CONST,fromUuid,Journal,ui,game:()=>game,canvas:()=>canvas}}},__webpack_module_cache__={};function __webpack_require__(t){var a=__webpack_module_cache__[t];if(void 0!==a)return a.exports;var e=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](e,e.exports,__webpack_require__),e.exports}var __webpack_exports__={};(()=>{const t=__webpack_require__(927),a=__webpack_require__(344),e=__webpack_require__(101);t.Hooks.on("init",(()=>{a.initialize(),e.initialize()}))})()})();