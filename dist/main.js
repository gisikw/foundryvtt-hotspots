(()=>{var __webpack_modules__={101:(t,e,a)=>{const s=a(927),i=a(293),n=["updateScene","updateDrawing","deleteDrawing"];t.exports=class{static initialize(){s.Hooks.on("canvasReady",this.handleCanvasReady.bind(this)),n.forEach((t=>{s.Hooks.on(t,this.updateActiveDrawingTargets.bind(this))}))}static handleCanvasReady(){s.canvas().stage.on("click",this.handleBoardClick.bind(this)),this.updateActiveDrawingTargets()}static updateActiveDrawingTargets(){this.activeDrawingTargets=s.canvas().drawings.placeables.filter((t=>this.drawingHasClickHotspot(t)&&this.hotspotEnabledForHiddenStatus(t)))}static drawingHasClickHotspot(t){const{hotspots:e}=t.data.flags;return e&&e.click&&e.click.uuid&&e.click.uuid.length}static hotspotEnabledForHiddenStatus(t){return!(t.data.flags.hotspots.click.disableHidden&&t.data.hidden)}static handleBoardClick(t){if(!this.activeDrawingTargets.length||s.canvas().activeLayer===s.canvas().drawings)return;const e=this.getCanvasPoint(t),a=this.activeDrawingTargets.find((t=>this.isPointInsideBoundingBox(e,t)&&this.isPointInsideShape(e,t)));a&&this.triggerEntity(a)}static getCanvasPoint(t){const e=s.canvas(),{tx:a,ty:i}=e.tokens.worldTransform,{x:n,y:o}=e.stage.scale;return{x:(t.data.global.x-a)/n,y:(t.data.global.y-i)/o}}static isPointInsideBoundingBox(t,e){const{width:a,height:s,x:i,y:n}=e.data;return Number.between(t.x,i,i+a)&&Number.between(t.y,n,n+s)}static isPointInsideShape(t,e){const{data:a}=e,{width:i,height:n,x:o,y:r}=a;if(a.type===s.CONST.DRAWING_TYPES.RECTANGLE)return!0;if(a.type===s.CONST.DRAWING_TYPES.ELLIPSE){if(!i||!n)return!1;const e=o+i/2-t.x,a=r+n/2-t.y;return e*e*4/(i*i)+a*a*4/(n*n)<=1}if(a.type===s.CONST.DRAWING_TYPES.POLYGON){const e=t.x-o,s=t.y-r;let i=0;for(let t=0;t<a.points.length;++t){const n=t+1===a.points.length?0:t+1;a.points[t][1]<=s&&a.points[n][1]>s&&(a.points[n][0]-a.points[t][0])*(s-a.points[t][1])-(a.points[n][1]-a.points[t][1])*(e-a.points[t][0])>0&&++i,a.points[t][1]>s&&a.points[n][1]<=s&&(a.points[n][0]-a.points[t][0])*(s-a.points[t][1])-(a.points[n][1]-a.points[t][1])*(e-a.points[t][0])<0&&--i}return 0!==i}return!1}static async triggerEntity(t){(await i.fromUuid(t.data.flags.hotspots.click.uuid)).activate()}}},344:(t,e,a)=>{const s=a(927),i=a(293),n=[s.CONST.DRAWING_TYPES.RECTANGLE,s.CONST.DRAWING_TYPES.ELLIPSE,s.CONST.DRAWING_TYPES.POLYGON],o={click:{title:"Click",categoryIcon:"fa-mouse-pointer",description:"This macro will fire when a player clicks within the bounds of the drawing."},enter:{title:"Enter",categoryIcon:"fa-sign-in-alt",description:"Select a macro to fire when a player's token enters the bounds of the drawing."},exit:{title:"Exit",categoryIcon:"fa-sign-out-alt",description:"Select a macro to fire when a player's token leaves the bounds of the drawing."}},r="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";class c{static initialize(){s.Hooks.on("renderDrawingConfig",c.handleRenderDrawingConfig.bind(this))}static async handleRenderDrawingConfig(t,e,a){if(!s.game().user.isGM||!n.includes(a.object.type))return;const i=await this.prepareData(a);await this.injectTab(e,i),this.createDropZones(e),this.addDeleteListeners(e)}static async prepareData(t){const e=s.mergeObject({...o},t.object.flags.hotspots);return{hotspots:Object.fromEntries(await Promise.all(Object.keys(e).map((async t=>{const a={img:r,...e[t]};if(a.uuid){const t=await i.fromUuid(a.uuid);a.img=t.getImg(),a.type=t.getType(),a.name=t.getName(),a.icon=t.getIcon()}return[t,a]}))))}}static async injectTab(t,e){s.renderTemplate("modules/hotspots/templates/drawing-config-hotspots-nav.hbs").then((e=>{t.find(".tabs .item").last().after(e)}));const a=await s.renderTemplate("modules/hotspots/templates/drawing-config-hotspots-tab.hbs",e);await t.find(".tab").last().after(a)}static createDropZones(t){new s.DragDrop({dropSelector:".hotspots-target",callbacks:{drop:this.handleDrop.bind(this)}}).bind(t[0])}static async handleDrop(t){const{type:e,pack:a,id:s}=JSON.parse(t.dataTransfer.getData("text/plain"));if(!Object.keys(i.subclasses).includes(e))return;const n=a?`Compendium.${a}.${s}`:`${e}.${s}`,o=await i.fromUuid(n),r=$(t.target).closest(".form-group");r.find("img").attr("src",o.getImg()),r.find(".hotspots-icon").removeClass().addClass(`hotspots-icon fas ${o.getIcon()}`),r.find(".hotspots-name").text(o.getName()),r.find(".hotspots-type").text(`(${o.getType()})`),r.find("input[type='hidden']").val(n),r.find(".hotspots-fields").addClass("enabled")}static addDeleteListeners(t){t.find(".hotspots-delete").on("click",(({target:t})=>{const e=$(t);e.removeClass("enabled");const a=e.closest(".form-group");a.find(".hotspots-fields").removeClass("enabled"),a.find("input[type='hidden']").val(""),a.find("img").attr("src",r),a.find(".hotspots-icon").removeClass().addClass("hotspots-icon fas")}))}}t.exports=c},293:(t,e,a)=>{const s=a(927);class i{static async fromUuid(t){const e=await s.fromUuid(t);return new(i.subclasses[e.entity]||i)(t,e)}constructor(t,e){this.uuid=t,this.object=e}getImg(){return"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="}getName(){return this.object.data.name}getType(){return this.object.entity}getIcon(){return""}}t.exports=i,i.subclasses={Actor:a(251),Item:a(126),JournalEntry:a(254),Macro:a(47),Playlist:a(88),RollTable:a(435),Scene:a(1)}},251:(t,e,a)=>{const s=a(293);t.exports=class extends s{async activate(){this.object.sheet.render(!0)}getImg(){return this.object.img}}},126:(t,e,a)=>{const s=a(293);t.exports=class extends s{async activate(){this.object.sheet.render(!0)}getImg(){return this.object.img}}},254:(t,e,a)=>{const s=a(293),i=a(927);t.exports=class extends s{async activate(){i.Journal._showEntry(this.uuid)}getIcon(){return"fa-book-open"}}},47:(module,__unused_webpack_exports,__webpack_require__)=>{const Entity=__webpack_require__(293),Foundry=__webpack_require__(927);class Macro extends Entity{getImg(){return this.object.data.img}async activate(){const macro=this.object;if("chat"===macro.data.type)Foundry.ui.chat.processMessage(macro.data.command).catch((t=>{Foundry.ui.notifications.error("There was an error in your chat message syntax."),console.error(t)}));else if("script"===macro.data.type)try{eval(macro.data.command)}catch(t){Foundry.ui.notifications.error("There was an error in your macro syntax. See the browser console for details"),console.error(t)}}}module.exports=Macro},88:(t,e,a)=>{const s=a(293);t.exports=class extends s{getIcon(){return"fa-music"}async activate(){this.object.playAll()}}},435:(t,e,a)=>{const s=a(293);t.exports=class extends s{async activate(){this.object.draw()}getImg(){return this.object.data.img}}},1:(t,e,a)=>{const s=a(293);t.exports=class extends s{getImg(){return this.object.data.img}async activate(){this.object.view()}}},927:t=>{t.exports={renderTemplate,mergeObject,DragDrop,Hooks,CONST,fromUuid,Journal,ui,game:()=>game,canvas:()=>canvas}}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var a=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](a,a.exports,__webpack_require__),a.exports}var __webpack_exports__={};(()=>{const t=__webpack_require__(927),e=__webpack_require__(344),a=__webpack_require__(101);t.Hooks.on("init",(()=>{e.initialize(),a.initialize()}))})()})();