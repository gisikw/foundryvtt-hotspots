(()=>{var __webpack_modules__={101:(t,e,s)=>{const a=s(927),i=s(293),n=["updateScene","updateDrawing","deleteDrawing"];t.exports=class{static initialize(){a.Hooks.on("canvasReady",this.handleCanvasReady.bind(this)),n.forEach((t=>{a.Hooks.on(t,this.updateActiveDrawingTargets.bind(this))}))}static handleCanvasReady(){a.canvas().stage.on("click",this.handleBoardClick.bind(this)),this.updateActiveDrawingTargets()}static updateActiveDrawingTargets(){this.activeDrawingTargets=a.canvas().drawings.placeables.filter((t=>this.drawingHasClickHotspot(t)&&this.hotspotEnabledForHiddenStatus(t)))}static drawingHasClickHotspot(t){const{hotspots:e}=t.data.flags;return e&&e.click&&e.click.uuid&&e.click.uuid.length}static hotspotEnabledForHiddenStatus(t){return!(t.data.flags.hotspots.click.disableHidden&&t.data.hidden)}static handleBoardClick(t){if(!this.activeDrawingTargets.length||a.canvas().activeLayer===a.canvas().drawings)return;const e=this.getCanvasPoint(t),s=this.activeDrawingTargets.find((t=>this.isPointInsideBoundingBox(e,t)&&this.isPointInsideShape(e,t)));s&&this.triggerEntity(s)}static getCanvasPoint(t){const e=a.canvas(),{tx:s,ty:i}=e.tokens.worldTransform,{x:n,y:o}=e.stage.scale;return{x:(t.data.global.x-s)/n,y:(t.data.global.y-i)/o}}static isPointInsideBoundingBox(t,e){const{width:s,height:a,x:i,y:n}=e.data;return Number.between(t.x,i,i+s)&&Number.between(t.y,n,n+a)}static isPointInsideShape(t,e){const{data:s}=e,{width:i,height:n,x:o,y:r}=s;if(s.type===a.CONST.DRAWING_TYPES.RECTANGLE)return!0;if(s.type===a.CONST.DRAWING_TYPES.ELLIPSE){if(!i||!n)return!1;const e=o+i/2-t.x,s=r+n/2-t.y;return e*e*4/(i*i)+s*s*4/(n*n)<=1}if(s.type===a.CONST.DRAWING_TYPES.POLYGON){const e=t.x-o,a=t.y-r;let i=0;for(let t=0;t<s.points.length;t+=1){const n=t+1===s.points.length?0:t+1;s.points[t][1]<=a&&s.points[n][1]>a&&(s.points[n][0]-s.points[t][0])*(a-s.points[t][1])-(s.points[n][1]-s.points[t][1])*(e-s.points[t][0])>0&&(i+=1),s.points[t][1]>a&&s.points[n][1]<=a&&(s.points[n][0]-s.points[t][0])*(a-s.points[t][1])-(s.points[n][1]-s.points[t][1])*(e-s.points[t][0])<0&&(i-=1)}return 0!==i}return!1}static async triggerEntity(t){(await i.fromUuid(t.data.flags.hotspots.click.uuid)).activate()}}},344:(t,e,s)=>{const a=s(927),i=s(293);s(521);const n=[a.CONST.DRAWING_TYPES.RECTANGLE,a.CONST.DRAWING_TYPES.ELLIPSE,a.CONST.DRAWING_TYPES.POLYGON],o={click:{title:a.game().i18n.localize("Hotspots.ClickTitle"),categoryIcon:"fa-mouse-pointer",description:a.game().i18n.localize("Hotspots.ClickDescription")},enter:{title:a.game().i18n.localize("Hotspots.EnterTitle"),categoryIcon:"fa-sign-in-alt",description:a.game().i18n.localize("Hotspots.EnterDescription")},exit:{title:a.game().i18n.localize("Hotspots.ExitTitle"),categoryIcon:"fa-sign-out-alt",description:a.game().i18n.localize("Hotspots.ExitDescription")}},r="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";class c{static initialize(){a.Hooks.on("renderDrawingConfig",c.handleRenderDrawingConfig.bind(this))}static async handleRenderDrawingConfig(t,e,s){if(!a.game().user.isGM||!n.includes(s.object.type))return;const i=await this.prepareData(s);await this.injectTab(e,i),this.createDropZones(e),this.addDeleteListeners(e)}static async prepareData(t){const e=a.mergeObject({...o},t.object.flags.hotspots);return{hotspots:Object.fromEntries(await Promise.all(Object.keys(e).map((async t=>{const s={img:r,...e[t]};if(s.uuid){const t=await i.fromUuid(s.uuid);s.img=t.getImg(),s.type=t.getType(),s.name=t.getName(),s.icon=t.getIcon()}return[t,s]}))))}}static async injectTab(t,e){a.renderTemplate("modules/hotspots/templates/drawing-config-hotspots-nav.hbs").then((e=>{t.find(".tabs .item").last().after(e)}));const s=await a.renderTemplate("modules/hotspots/templates/drawing-config-hotspots-tab.hbs",e);await t.find(".tab").last().after(s)}static createDropZones(t){new a.DragDrop({dropSelector:".hotspots-target",callbacks:{drop:this.handleDrop.bind(this)}}).bind(t[0])}static async handleDrop(t){const{type:e,pack:s,id:a}=JSON.parse(t.dataTransfer.getData("text/plain"));if(!Object.keys(i.subclasses).includes(e))return;const n=s?`Compendium.${s}.${a}`:`${e}.${a}`,o=await i.fromUuid(n),r=$(t.target).closest(".form-group");r.find("img").attr("src",o.getImg()),r.find(".hotspots-icon").removeClass().addClass(`hotspots-icon fas ${o.getIcon()}`),r.find(".hotspots-name").text(o.getName()),r.find(".hotspots-type").text(`(${o.getType()})`),r.find("input[type='hidden']").val(n),r.find(".hotspots-fields").addClass("enabled")}static addDeleteListeners(t){t.find(".hotspots-delete").on("click",(({target:t})=>{const e=$(t);e.removeClass("enabled");const s=e.closest(".form-group");s.find(".hotspots-fields").removeClass("enabled"),s.find("input[type='hidden']").val(""),s.find("img").attr("src",r),s.find(".hotspots-icon").removeClass().addClass("hotspots-icon fas")}))}}t.exports=c},293:(t,e,s)=>{const a=s(927);class i{static async fromUuid(t){const e=await a.fromUuid(t);return new(i.subclasses[e.entity]||i)(t,e)}constructor(t,e){this.uuid=t,this.object=e}getImg(){return"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="}getName(){return this.object.data.name}getType(){return this.object.entity}getIcon(){return""}}t.exports=i,i.subclasses={Actor:s(251),Item:s(126),JournalEntry:s(254),Macro:s(47),Playlist:s(88),RollTable:s(435),Scene:s(1)}},251:(t,e,s)=>{const a=s(293);t.exports=class extends a{async activate(){this.object.sheet.render(!0)}getImg(){return this.object.img}}},126:(t,e,s)=>{const a=s(293);t.exports=class extends a{async activate(){this.object.sheet.render(!0)}getImg(){return this.object.img}}},254:(t,e,s)=>{const a=s(293),i=s(927);t.exports=class extends a{async activate(){i.Journal._showEntry(this.uuid)}getIcon(){return"fa-book-open"}}},47:(module,__unused_webpack_exports,__webpack_require__)=>{const Entity=__webpack_require__(293),Foundry=__webpack_require__(927);class Macro extends Entity{getImg(){return this.object.data.img}async activate(){const macro=this.object;if("chat"===macro.data.type)Foundry.ui.chat.processMessage(macro.data.command).catch((t=>{Foundry.ui.notifications.error("There was an error in your chat message syntax."),console.error(t)}));else if("script"===macro.data.type)try{eval(macro.data.command)}catch(t){Foundry.ui.notifications.error("There was an error in your macro syntax. See the browser console for details"),console.error(t)}}}module.exports=Macro},88:(t,e,s)=>{const a=s(293);t.exports=class extends a{getIcon(){return"fa-music"}async activate(){this.object.playAll()}}},435:(t,e,s)=>{const a=s(293);t.exports=class extends a{async activate(){this.object.draw()}getImg(){return this.object.data.img}}},1:(t,e,s)=>{const a=s(293);t.exports=class extends a{getImg(){return this.object.data.img}async activate(){this.object.view()}}},927:t=>{t.exports={renderTemplate,mergeObject,Handlebars,DragDrop,Hooks,CONST,fromUuid,Journal,ui,game:()=>game,canvas:()=>canvas}},521:(t,e,s)=>{s(927).Handlebars.registerHelper({condStr:(t,e)=>t?e:""})}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var s=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](s,s.exports,__webpack_require__),s.exports}var __webpack_exports__={};(()=>{const t=__webpack_require__(927),e=__webpack_require__(344),s=__webpack_require__(101);t.Hooks.on("init",(()=>{e.initialize(),s.initialize()}))})()})();